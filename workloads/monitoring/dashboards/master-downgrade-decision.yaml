# ë§ˆìŠ¤í„° ë…¸ë“œ ë‹¤ìš´ê·¸ë ˆì´ë“œ ê²°ì • ëŒ€ì‹œë³´ë“œ
# ëª©ì : t3.xlarge â†’ t3.large ì „í™˜ ê°€ëŠ¥ ì—¬ë¶€ íŒë‹¨
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-master-downgrade
  namespace: prometheus
  labels:
    grafana_dashboard: '1'
    app: grafana
  annotations:
    grafana_folder: Master Node
data:
  master-downgrade-decision.json: |
    {
      "annotations": {
        "list": []
      },
      "title": "ğŸ“‰ Master Node - Downgrade Decision",
      "uid": "master-downgrade-decision",
      "version": 1,
      "timezone": "browser",
      "schemaVersion": 38,
      "refresh": "1m",
      "time": {
        "from": "now-7d",
        "to": "now"
      },
      "templating": {
        "list": []
      },
      "panels": [
        {
          "title": "ğŸ¯ ë‹¤ìš´ê·¸ë ˆì´ë“œ íŒë‹¨ ê¸°ì¤€",
          "type": "row",
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
          "collapsed": false
        },
        {
          "title": "âœ… ë‹¤ìš´ê·¸ë ˆì´ë“œ ê°€ëŠ¥ ì—¬ë¶€",
          "type": "stat",
          "gridPos": { "h": 6, "w": 8, "x": 0, "y": 1 },
          "description": "7ì¼ê°„ ë©”ëª¨ë¦¬ í”¼í¬ê°€ 6GB ë¯¸ë§Œì´ë©´ t3.large(8GB)ë¡œ ë‹¤ìš´ê·¸ë ˆì´ë“œ ê°€ëŠ¥",
          "targets": [
            {
              "expr": "max_over_time((node_memory_MemTotal_bytes{instance=~\".*k8s-master.*\"} - node_memory_MemAvailable_bytes{instance=~\".*k8s-master.*\"})[7d:1h]) / 1024 / 1024 / 1024 < 6",
              "legendFormat": "Safe to Downgrade"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "mappings": [
                { "type": "value", "options": { "1": { "text": "âœ… ê°€ëŠ¥ (í”¼í¬ < 6GB)", "color": "green" } } },
                { "type": "value", "options": { "0": { "text": "âš ï¸ ìœ„í—˜ (í”¼í¬ â‰¥ 6GB)", "color": "red" } } }
              ]
            }
          }
        },
        {
          "title": "7ì¼ê°„ ë©”ëª¨ë¦¬ í”¼í¬ (GB)",
          "type": "stat",
          "gridPos": { "h": 6, "w": 8, "x": 8, "y": 1 },
          "description": "6GB ë¯¸ë§Œì´ì–´ì•¼ t3.large(8GB)ë¡œ ì•ˆì „í•˜ê²Œ ë‹¤ìš´ê·¸ë ˆì´ë“œ ê°€ëŠ¥",
          "targets": [
            {
              "expr": "max_over_time((node_memory_MemTotal_bytes{instance=~\".*k8s-master.*\"} - node_memory_MemAvailable_bytes{instance=~\".*k8s-master.*\"})[7d:1h]) / 1024 / 1024 / 1024",
              "legendFormat": "Peak Memory"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "decgbytes",
              "decimals": 2,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": null },
                  { "color": "yellow", "value": 5 },
                  { "color": "red", "value": 6 }
                ]
              }
            }
          }
        },
        {
          "title": "7ì¼ê°„ ë©”ëª¨ë¦¬ í‰ê·  (GB)",
          "type": "stat",
          "gridPos": { "h": 6, "w": 8, "x": 16, "y": 1 },
          "targets": [
            {
              "expr": "avg_over_time((node_memory_MemTotal_bytes{instance=~\".*k8s-master.*\"} - node_memory_MemAvailable_bytes{instance=~\".*k8s-master.*\"})[7d:1h]) / 1024 / 1024 / 1024",
              "legendFormat": "Avg Memory"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "decgbytes",
              "decimals": 2,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": null },
                  { "color": "yellow", "value": 4 },
                  { "color": "red", "value": 5 }
                ]
              }
            }
          }
        },
        {
          "title": "ğŸ“Š 7ì¼ê°„ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¶”ì´",
          "type": "row",
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 7 },
          "collapsed": false
        },
        {
          "title": "ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ vs ë‹¤ìš´ê·¸ë ˆì´ë“œ ê¸°ì¤€ì„  (7ì¼)",
          "type": "timeseries",
          "gridPos": { "h": 10, "w": 24, "x": 0, "y": 8 },
          "description": "ë¹¨ê°„ì„ (6GB)ì„ ë„˜ì§€ ì•Šìœ¼ë©´ t3.largeë¡œ ì•ˆì „í•˜ê²Œ ë‹¤ìš´ê·¸ë ˆì´ë“œ ê°€ëŠ¥",
          "targets": [
            {
              "expr": "(node_memory_MemTotal_bytes{instance=~\".*k8s-master.*\"} - node_memory_MemAvailable_bytes{instance=~\".*k8s-master.*\"}) / 1024 / 1024 / 1024",
              "legendFormat": "ì‹¤ì œ ì‚¬ìš©ëŸ‰"
            },
            {
              "expr": "8",
              "legendFormat": "ğŸ”´ t3.large ì œí•œ (8GB)"
            },
            {
              "expr": "6",
              "legendFormat": "ğŸŸ¡ ì•ˆì „ ê¸°ì¤€ (6GB)"
            },
            {
              "expr": "4",
              "legendFormat": "ğŸŸ¢ ê¶Œì¥ ê¸°ì¤€ (4GB)"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "decgbytes",
              "min": 0,
              "max": 16,
              "custom": {
                "lineWidth": 2,
                "fillOpacity": 10,
                "pointSize": 1
              }
            },
            "overrides": [
              {
                "matcher": { "id": "byName", "options": "ğŸ”´ t3.large ì œí•œ (8GB)" },
                "properties": [
                  { "id": "color", "value": { "mode": "fixed", "fixedColor": "red" } },
                  { "id": "custom.lineStyle", "value": { "fill": "dash" } }
                ]
              },
              {
                "matcher": { "id": "byName", "options": "ğŸŸ¡ ì•ˆì „ ê¸°ì¤€ (6GB)" },
                "properties": [
                  { "id": "color", "value": { "mode": "fixed", "fixedColor": "yellow" } },
                  { "id": "custom.lineStyle", "value": { "fill": "dash" } }
                ]
              },
              {
                "matcher": { "id": "byName", "options": "ğŸŸ¢ ê¶Œì¥ ê¸°ì¤€ (4GB)" },
                "properties": [
                  { "id": "color", "value": { "mode": "fixed", "fixedColor": "green" } },
                  { "id": "custom.lineStyle", "value": { "fill": "dash" } }
                ]
              }
            ]
          }
        },
        {
          "title": "ğŸ” ì»´í¬ë„ŒíŠ¸ë³„ ë¶„ì„",
          "type": "row",
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 18 },
          "collapsed": false
        },
        {
          "title": "kube-apiserver 7ì¼ê°„ í”¼í¬ ë©”ëª¨ë¦¬ (GB)",
          "type": "stat",
          "gridPos": { "h": 5, "w": 6, "x": 0, "y": 19 },
          "description": "2GB ë¯¸ë§Œì´ì–´ì•¼ ì•ˆì „",
          "targets": [
            {
              "expr": "max_over_time(container_memory_working_set_bytes{pod=~\"kube-apiserver.*\", container!=\"POD\"}[7d:1h]) / 1024 / 1024 / 1024",
              "legendFormat": "apiserver Peak"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "decgbytes",
              "decimals": 2,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": null },
                  { "color": "yellow", "value": 1.5 },
                  { "color": "red", "value": 2 }
                ]
              }
            }
          }
        },
        {
          "title": "ArgoCD 7ì¼ê°„ í”¼í¬ ë©”ëª¨ë¦¬ (GB)",
          "type": "stat",
          "gridPos": { "h": 5, "w": 6, "x": 6, "y": 19 },
          "description": "1GB ë¯¸ë§Œì´ì–´ì•¼ ì•ˆì „",
          "targets": [
            {
              "expr": "max_over_time(sum(container_memory_working_set_bytes{namespace=\"argocd\", container!=\"POD\"})[7d:1h]) / 1024 / 1024 / 1024",
              "legendFormat": "ArgoCD Peak"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "decgbytes",
              "decimals": 2,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": null },
                  { "color": "yellow", "value": 0.8 },
                  { "color": "red", "value": 1 }
                ]
              }
            }
          }
        },
        {
          "title": "etcd 7ì¼ê°„ í”¼í¬ ë©”ëª¨ë¦¬ (MB)",
          "type": "stat",
          "gridPos": { "h": 5, "w": 6, "x": 12, "y": 19 },
          "targets": [
            {
              "expr": "max_over_time(container_memory_working_set_bytes{pod=~\"etcd.*\", container!=\"POD\"}[7d:1h]) / 1024 / 1024",
              "legendFormat": "etcd Peak"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "decmBytes",
              "decimals": 0,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": null },
                  { "color": "yellow", "value": 300 },
                  { "color": "red", "value": 500 }
                ]
              }
            }
          }
        },
        {
          "title": "ì „ì²´ Pod í•©ê³„ 7ì¼ í”¼í¬ (GB)",
          "type": "stat",
          "gridPos": { "h": 5, "w": 6, "x": 18, "y": 19 },
          "targets": [
            {
              "expr": "max_over_time(sum(container_memory_working_set_bytes{node=\"k8s-master\", container!=\"\", container!=\"POD\"})[7d:1h]) / 1024 / 1024 / 1024",
              "legendFormat": "All Pods Peak"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "decgbytes",
              "decimals": 2,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": null },
                  { "color": "yellow", "value": 4 },
                  { "color": "red", "value": 5 }
                ]
              }
            }
          }
        },
        {
          "title": "ğŸ’° ë¹„ìš© ë¹„êµ",
          "type": "row",
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 24 },
          "collapsed": false
        },
        {
          "title": "ğŸ’µ ë¹„ìš© ì ˆê° ì˜ˆìƒ",
          "type": "text",
          "gridPos": { "h": 6, "w": 24, "x": 0, "y": 25 },
          "options": {
            "mode": "markdown",
            "content": "## ë‹¤ìš´ê·¸ë ˆì´ë“œ ë¹„ìš© ë¶„ì„\n\n| í•­ëª© | t3.xlarge (í˜„ì¬) | t3.large (ë³€ê²½ í›„) |\n|------|------------------|-------------------|\n| vCPU | 4 | 2 |\n| RAM | 16GB | 8GB |\n| ì›” ë¹„ìš© | $154.18 | $77.09 |\n\n### ğŸ’° ì›”ê°„ ì ˆê°ì•¡: **$77.09 (~â‚©110,000)**\n### ğŸ’° ì—°ê°„ ì ˆê°ì•¡: **$925.08 (~â‚©1,320,000)**\n\n---\n\n### âš ï¸ ë‹¤ìš´ê·¸ë ˆì´ë“œ ì¡°ê±´\n- âœ… 7ì¼ê°„ ë©”ëª¨ë¦¬ í”¼í¬ < 6GB\n- âœ… kube-apiserver í”¼í¬ < 2GB\n- âœ… ArgoCD í”¼í¬ < 1GB"
          }
        }
      ]
    }
